<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ajax get | 潇湘</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.17177765.css" as="style"><link rel="preload" href="/assets/js/app.78ed8d42.js" as="script"><link rel="preload" href="/assets/js/2.ed6f9a26.js" as="script"><link rel="preload" href="/assets/js/75.97c06d97.js" as="script"><link rel="prefetch" href="/assets/js/10.744c5538.js"><link rel="prefetch" href="/assets/js/100.12528247.js"><link rel="prefetch" href="/assets/js/101.23568382.js"><link rel="prefetch" href="/assets/js/102.ab7a6ca4.js"><link rel="prefetch" href="/assets/js/103.14195ce7.js"><link rel="prefetch" href="/assets/js/104.048cb757.js"><link rel="prefetch" href="/assets/js/105.bf3a7814.js"><link rel="prefetch" href="/assets/js/106.7794327a.js"><link rel="prefetch" href="/assets/js/107.dbb95f21.js"><link rel="prefetch" href="/assets/js/108.1584ed8a.js"><link rel="prefetch" href="/assets/js/11.d61550a7.js"><link rel="prefetch" href="/assets/js/12.4706ddc4.js"><link rel="prefetch" href="/assets/js/13.2dad8bcb.js"><link rel="prefetch" href="/assets/js/14.df2f21de.js"><link rel="prefetch" href="/assets/js/15.8f4db09d.js"><link rel="prefetch" href="/assets/js/16.ed6d5c0c.js"><link rel="prefetch" href="/assets/js/17.f1bc0365.js"><link rel="prefetch" href="/assets/js/18.50f00392.js"><link rel="prefetch" href="/assets/js/19.a9d7869f.js"><link rel="prefetch" href="/assets/js/20.1b3519e4.js"><link rel="prefetch" href="/assets/js/21.7660e629.js"><link rel="prefetch" href="/assets/js/22.cd5ea230.js"><link rel="prefetch" href="/assets/js/23.0655368f.js"><link rel="prefetch" href="/assets/js/24.8c455dbf.js"><link rel="prefetch" href="/assets/js/25.209fd99a.js"><link rel="prefetch" href="/assets/js/26.238b7928.js"><link rel="prefetch" href="/assets/js/27.e3070242.js"><link rel="prefetch" href="/assets/js/28.76b46c2d.js"><link rel="prefetch" href="/assets/js/29.9e81b534.js"><link rel="prefetch" href="/assets/js/3.49908abd.js"><link rel="prefetch" href="/assets/js/30.96a862df.js"><link rel="prefetch" href="/assets/js/31.4b80030d.js"><link rel="prefetch" href="/assets/js/32.609f4077.js"><link rel="prefetch" href="/assets/js/33.49eb0337.js"><link rel="prefetch" href="/assets/js/34.9540ba7c.js"><link rel="prefetch" href="/assets/js/35.749804cd.js"><link rel="prefetch" href="/assets/js/36.35d83563.js"><link rel="prefetch" href="/assets/js/37.8e6c63e1.js"><link rel="prefetch" href="/assets/js/38.bf34299f.js"><link rel="prefetch" href="/assets/js/39.a37d6556.js"><link rel="prefetch" href="/assets/js/4.2fd44320.js"><link rel="prefetch" href="/assets/js/40.bc823c0f.js"><link rel="prefetch" href="/assets/js/41.8d2e2798.js"><link rel="prefetch" href="/assets/js/42.37c25db8.js"><link rel="prefetch" href="/assets/js/43.9c97f687.js"><link rel="prefetch" href="/assets/js/44.ff028893.js"><link rel="prefetch" href="/assets/js/45.01efacfb.js"><link rel="prefetch" href="/assets/js/46.f8a78224.js"><link rel="prefetch" href="/assets/js/47.b8f9634d.js"><link rel="prefetch" href="/assets/js/48.cf379abb.js"><link rel="prefetch" href="/assets/js/49.8b285e60.js"><link rel="prefetch" href="/assets/js/5.ecc8810c.js"><link rel="prefetch" href="/assets/js/50.88f4d907.js"><link rel="prefetch" href="/assets/js/51.3804cdb8.js"><link rel="prefetch" href="/assets/js/52.ef591a91.js"><link rel="prefetch" href="/assets/js/53.6d9ccf37.js"><link rel="prefetch" href="/assets/js/54.8822b956.js"><link rel="prefetch" href="/assets/js/55.2a12afed.js"><link rel="prefetch" href="/assets/js/56.ee017a95.js"><link rel="prefetch" href="/assets/js/57.6f90025a.js"><link rel="prefetch" href="/assets/js/58.21623874.js"><link rel="prefetch" href="/assets/js/59.ad3e63bb.js"><link rel="prefetch" href="/assets/js/6.da6f50eb.js"><link rel="prefetch" href="/assets/js/60.af422fe8.js"><link rel="prefetch" href="/assets/js/61.61fc7832.js"><link rel="prefetch" href="/assets/js/62.d9cef99e.js"><link rel="prefetch" href="/assets/js/63.0d660af9.js"><link rel="prefetch" href="/assets/js/64.2af87bf5.js"><link rel="prefetch" href="/assets/js/65.c272a072.js"><link rel="prefetch" href="/assets/js/66.b6471479.js"><link rel="prefetch" href="/assets/js/67.229494e2.js"><link rel="prefetch" href="/assets/js/68.ac419f7b.js"><link rel="prefetch" href="/assets/js/69.ab53b522.js"><link rel="prefetch" href="/assets/js/7.2ef8d3fd.js"><link rel="prefetch" href="/assets/js/70.40fbb748.js"><link rel="prefetch" href="/assets/js/71.316fc8aa.js"><link rel="prefetch" href="/assets/js/72.b303cab0.js"><link rel="prefetch" href="/assets/js/73.7c54ac2a.js"><link rel="prefetch" href="/assets/js/74.c9991e9c.js"><link rel="prefetch" href="/assets/js/76.e954d2a8.js"><link rel="prefetch" href="/assets/js/77.42a8b0a8.js"><link rel="prefetch" href="/assets/js/78.153baedc.js"><link rel="prefetch" href="/assets/js/79.16748594.js"><link rel="prefetch" href="/assets/js/8.4d3292a1.js"><link rel="prefetch" href="/assets/js/80.6cb468cb.js"><link rel="prefetch" href="/assets/js/81.dfa24c0a.js"><link rel="prefetch" href="/assets/js/82.fef52bba.js"><link rel="prefetch" href="/assets/js/83.4a2829fb.js"><link rel="prefetch" href="/assets/js/84.61e6715d.js"><link rel="prefetch" href="/assets/js/85.b800ffb5.js"><link rel="prefetch" href="/assets/js/86.eb1b7643.js"><link rel="prefetch" href="/assets/js/87.3c485d24.js"><link rel="prefetch" href="/assets/js/88.b905973e.js"><link rel="prefetch" href="/assets/js/89.b9960300.js"><link rel="prefetch" href="/assets/js/9.f386bcbc.js"><link rel="prefetch" href="/assets/js/90.06f53182.js"><link rel="prefetch" href="/assets/js/91.9e885519.js"><link rel="prefetch" href="/assets/js/92.20ba0686.js"><link rel="prefetch" href="/assets/js/93.339ed679.js"><link rel="prefetch" href="/assets/js/94.43580873.js"><link rel="prefetch" href="/assets/js/95.ec416578.js"><link rel="prefetch" href="/assets/js/96.b363d807.js"><link rel="prefetch" href="/assets/js/97.d01994b9.js"><link rel="prefetch" href="/assets/js/98.1376d317.js"><link rel="prefetch" href="/assets/js/99.d1359039.js">
    <link rel="stylesheet" href="/assets/css/0.styles.17177765.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">潇湘</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  Friend
</a></div><div class="nav-item"><a href="https://github.com/xiaoxiang516" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  Friend
</a></div><div class="nav-item"><a href="https://github.com/xiaoxiang516" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Home</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Buildwebsite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Basis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>V8.dev</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jsbooks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Javascript Mdn</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript-MDN/" aria-current="page" class="sidebar-link">/JavaScript-MDN/</a></li><li><a href="/JavaScript-MDN/FAQ.html" class="sidebar-link">页面加载过程</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Beforenote</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript-MDN/beforeNote/Module/" class="sidebar-link">/JavaScript-MDN/beforeNote/Module/</a></li><li><a href="/JavaScript-MDN/beforeNote/Navicat/mysql.html" class="sidebar-link">/JavaScript-MDN/beforeNote/Navicat/mysql.html</a></li><li><a href="/JavaScript-MDN/beforeNote/Web%E6%80%A7%E8%83%BD/" class="sidebar-link">/JavaScript-MDN/beforeNote/Web%E6%80%A7%E8%83%BD/</a></li><li><a href="/JavaScript-MDN/beforeNote/asynchronousProgramming/" class="sidebar-link">/JavaScript-MDN/beforeNote/asynchronousProgramming/</a></li><li><a href="/JavaScript-MDN/beforeNote/axios/" class="sidebar-link">/JavaScript-MDN/beforeNote/axios/</a></li><li><a href="/JavaScript-MDN/beforeNote/docs/theory/CSS.html" class="sidebar-link">/JavaScript-MDN/beforeNote/docs/theory/CSS.html</a></li><li><a href="/JavaScript-MDN/beforeNote/docs/theory/HTTP.html" class="sidebar-link">/JavaScript-MDN/beforeNote/docs/theory/HTTP.html</a></li><li><a href="/JavaScript-MDN/beforeNote/docs/theory/TCP.html" class="sidebar-link">/JavaScript-MDN/beforeNote/docs/theory/TCP.html</a></li><li><a href="/JavaScript-MDN/beforeNote/docs/theory/test.html" aria-current="page" class="active sidebar-link">ajax get</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript-MDN/beforeNote/docs/theory/test.html#ajax-get" class="sidebar-link">ajax get</a></li><li class="sidebar-sub-header"><a href="/JavaScript-MDN/beforeNote/docs/theory/test.html#get调用" class="sidebar-link">$get调用</a></li><li class="sidebar-sub-header"><a href="/JavaScript-MDN/beforeNote/docs/theory/test.html#promiseget" class="sidebar-link">$promiseGet</a></li></ul></li><li><a href="/JavaScript-MDN/beforeNote/docs/theory/后端接口.html" class="sidebar-link">后端接口篇</a></li><li><a href="/JavaScript-MDN/beforeNote/jsdoc/about-getting-started.html" class="sidebar-link">/JavaScript-MDN/beforeNote/jsdoc/about-getting-started.html</a></li><li><a href="/JavaScript-MDN/beforeNote/postman/interface.html" class="sidebar-link">后端接口</a></li><li><a href="/JavaScript-MDN/beforeNote/postman/postman.html" class="sidebar-link">安装卸载更新postman</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/" class="sidebar-link">/JavaScript-MDN/beforeNote/situ-javaScript/</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/JS/" class="sidebar-link">JAVASCRIPT</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/JS/JS/1.27%E6%98%9F%E6%9C%9F%E4%B8%89/4%201%E9%98%B2%E6%8A%96%20%E8%8A%82%E6%B5%81/" class="sidebar-link">/JavaScript-MDN/beforeNote/situ-javaScript/JS/JS/1.27%E6%98%9F%E6%9C%9F%E4%B8%89/4%201%E9%98%B2%E6%8A%96%20%E8%8A%82%E6%B5%81/</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/JS/JS/1.27星期三/4 6 this关键字 与箭头函数/this.html" class="sidebar-link">/JavaScript-MDN/beforeNote/situ-javaScript/JS/JS/1.27星期三/4 6 this关键字 与箭头函数/this.html</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/JS/JS/1.27星期三/4 8 Promise/readne.html" class="sidebar-link">/JavaScript-MDN/beforeNote/situ-javaScript/JS/JS/1.27星期三/4 8 Promise/readne.html</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/JS/实用工具库.html" class="sidebar-link">/JavaScript-MDN/beforeNote/situ-javaScript/JS/实用工具库.html</a></li><li><a href="/JavaScript-MDN/beforeNote/situ-javaScript/对象里面使用函数.html" class="sidebar-link">/JavaScript-MDN/beforeNote/situ-javaScript/对象里面使用函数.html</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Prototype</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>References</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Scope</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Web Performance</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ecma</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Eslint</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="ajax-get"><a href="#ajax-get" class="header-anchor">#</a> ajax get</h2> <p>主要是接口怎么封装，url怎么处理参数，params怎么传递
</p><details><summary>参数准备</summary>
url：参数拼接方式
域名写不写，
vue配置开发、测试、生产环境（不同环境，不同命令）
Token与特殊字符与encodeURIComponent
</details><p></p> <p>3.Ajax的参数</p> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> urlUploadPart<span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> partData<span class="token punctuation">,</span> <span class="token comment">// 二进制 file.slice(start, end)</span>
  <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d  <span class="token operator">||</span> <span class="token operator">!</span>d<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token operator">!</span>d<span class="token punctuation">.</span>data<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span>
      item<span class="token punctuation">.</span>failedPartNumbers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>partNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    item<span class="token punctuation">.</span>successAmount<span class="token operator">++</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    item<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'requestErr'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * Encodes a text string as a valid component of a Uniform Resource Identifier (URI).
 * @param uriComponent A value representing an encoded URI component.
 */</span>
declare <span class="token keyword">function</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">uriComponent</span><span class="token operator">:</span> string <span class="token operator">|</span> number <span class="token operator">|</span> boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> string<span class="token punctuation">;</span>

<span class="token keyword">let</span> url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/file-service/api/file/v1/upload/uploadByBody?accesstoken=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_this<span class="token punctuation">.</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  url <span class="token operator">=</span> url <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><p>监听数组的变化，在变化后执行某个东西
数组不可监听，那么就在每次引起数组变化的地方执行那项操作
Promise与(async (resolve, reject)
Promise.all
error: (err) =&gt; {}</p> <h3 id="this-ajax"><a href="#this-ajax" class="header-anchor">#</a> this.ajax</h3> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> window<span class="token punctuation">.</span>webConfig<span class="token punctuation">.</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/api/pdm/validate/api/plat/system/verifyCode/generate&quot;</span><span class="token punctuation">,</span>
	<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_this<span class="token punctuation">.</span>imagePath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data:image/gif;base64,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>VerifyImage<span class="token punctuation">.</span>_buffer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
		_this<span class="token punctuation">.</span>verifyCodeKey <span class="token operator">=</span> data<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>VerifyCodeKey
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">convertData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">var</span> convertResult <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> c <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				convertResult <span class="token operator">+=</span> c <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			convertResult <span class="token operator">=</span> convertResult<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> convertResult<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> convertResult<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> ajaxData <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">||</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">url</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>url <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">async</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>async <span class="token operator">||</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">data</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
		<span class="token literal-property property">dataType</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dataType <span class="token operator">||</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">contentType</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contentType <span class="token operator">||</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">beforeSend</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>beforeSend <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">success</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>success <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">error</span><span class="token operator">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>error <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	ajaxData<span class="token punctuation">.</span><span class="token function">beforeSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//xhr.responseType = ajaxData.dataType;</span>
	xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>ajaxData<span class="token punctuation">.</span>type<span class="token punctuation">,</span> ajaxData<span class="token punctuation">.</span>url<span class="token punctuation">,</span> ajaxData<span class="token punctuation">.</span>async<span class="token punctuation">)</span><span class="token punctuation">;</span>
	xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> ajaxData<span class="token punctuation">.</span>contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span> globalConfig<span class="token punctuation">.</span>authorization<span class="token punctuation">)</span><span class="token punctuation">;</span>

	xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">convertData</span><span class="token punctuation">(</span>ajaxData<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	xhr<span class="token punctuation">.</span>timeout <span class="token operator">?</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">115000</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
	xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				ajaxData<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				ajaxData<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		Vue<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'networkTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	xhr<span class="token punctuation">.</span><span class="token function-variable function">error</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		Vue<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'unknownMistake'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">type</span> <span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>  <span class="token comment">//提交方式</span>
	<span class="token literal-property property">url</span> <span class="token operator">:</span> url<span class="token punctuation">,</span><span class="token comment">//路径</span>
	<span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">//data : '',//数据，这里使用的是Json格式进行传输</span>
	<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		  <span class="token string-property property">&quot;Authorization&quot;</span><span class="token operator">:</span> sessionStorage<span class="token punctuation">.</span>token_type <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> sessionStorage<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//返回数据根据结果进行相应的处理</span>
	<span class="token comment">//console.log('外部链接响应',result)</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	  view<span class="token punctuation">.</span>ProductFamilyList <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function-variable function">error</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> errorInfo<span class="token punctuation">,</span> XMLObject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//异常返回数据根据结果进行相应的处理</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="get调用"><a href="#get调用" class="header-anchor">#</a> $get调用</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$get</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> res<span class="token punctuation">.</span>Rows
	<span class="token keyword">this</span><span class="token punctuation">.</span>paginationOpt<span class="token punctuation">.</span>pageTotal <span class="token operator">=</span> res<span class="token punctuation">.</span>Total
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * description get获取数据
 * @params {String} url：链接(必填)
 * @params {Object} params：参数(可选)
 * @params {Function} success: 成功回调方法(可选)
 * @params {Function} error：失败时的回调方法(可选)
 * **/</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> xx调用函数<span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token function">ajaxMethod</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** success 只有Code===0时才会执行，其他都为error**/</span>

  <span class="token keyword">function</span> <span class="token function">ajaxMethod</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error<span class="token punctuation">,</span> method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
          sParams <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          autoCloseLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          sSuccess <span class="token operator">=</span> success <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          sError <span class="token operator">=</span> error <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请输入链接'</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> isUpdate <span class="token operator">=</span> method <span class="token operator">===</span> <span class="token string">'post'</span> <span class="token operator">||</span> method <span class="token operator">===</span> <span class="token string">'put'</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>isUpdate <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Vue<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">'请输入参数'</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _this<span class="token punctuation">.</span><span class="token function">$loadingOpen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">'background-color'</span><span class="token operator">:</span> <span class="token string">'rgba(2,2,2,0.2)'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          _this<span class="token punctuation">.</span><span class="token function">$loadingOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              sSuccess <span class="token operator">=</span> data
              sError <span class="token operator">=</span> success <span class="token operator">||</span> sError
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              sParams <span class="token operator">=</span> data
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> menuid <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token keyword">var</span> route <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route
      <span class="token keyword">var</span> routeName
      <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          menuid <span class="token operator">=</span> route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>menuId <span class="token operator">||</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'activeMenuId'</span><span class="token punctuation">)</span>
          routeName <span class="token operator">=</span> route<span class="token punctuation">.</span>name
      <span class="token punctuation">}</span>

  <span class="token comment">// if (sParams.autoOpenLoading !== false) {</span>
  <span class="token comment">//   _this.$loadingOpen();</span>
  <span class="token comment">// } else {</span>
  <span class="token comment">//   autoCloseLoading = false;</span>
  <span class="token comment">//   delete sParams.autoOpenLoading;</span>
  <span class="token comment">// }</span>

      <span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">'MenuId'</span><span class="token operator">:</span> menuid
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">var</span> arrs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _this<span class="token punctuation">.</span>disabled <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> _this<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token string">''</span>
          arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sParams<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> sParams <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          config<span class="token punctuation">.</span>params <span class="token operator">=</span> sParams
      <span class="token punctuation">}</span>
      arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

      axios<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arrs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> res <span class="token operator">=</span> data<span class="token punctuation">.</span>data
          _this<span class="token punctuation">.</span><span class="token function">$loading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">999999999</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              Vue<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>Message<span class="token punctuation">)</span>
              <span class="token function">sError</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> res<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">sSuccess</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> res<span class="token punctuation">.</span>Data<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  <span class="token function">sSuccess</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> res<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 判断返回是否为字符串 主要考虑下载时调用获取接口会返回字符串的情况</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>Code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token function">sSuccess</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                      Vue<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'ajaxCallError.1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
      <span class="token comment">// if (res.Code &gt; 0) {</span>
      <span class="token comment">//   var resData = res.Data;</span>
      <span class="token comment">//   var resOption;</span>
      <span class="token comment">//   if (typeof resData === &quot;number&quot;) {</span>
      <span class="token comment">//    resOption = {</span>
      <span class="token comment">//     0: resData</span>
      <span class="token comment">//    }</span>
      <span class="token comment">//   } else if (Array.isArray(resData)) {</span>
      <span class="token comment">//    resOption = {};</span>
      <span class="token comment">//    resData.forEach(function (data, index) {</span>
      <span class="token comment">//     resOption[index] = data;</span>
      <span class="token comment">//    });</span>
      <span class="token comment">//   }</span>
      <span class="token comment">//   //layer.msg(res.Message, {icon: 2});</span>
      <span class="token comment">//   Vue.errorMsg(res.Message);</span>
      <span class="token comment">// }</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> error <span class="token operator">!==</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>Code <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">var</span> <span class="token function-variable function">errorFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">text1<span class="token punctuation">,</span> text2<span class="token punctuation">,</span> text3<span class="token punctuation">,</span> text4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'body&gt;.dialog-error'</span><span class="token punctuation">)</span>

                      <span class="token keyword">var</span> <span class="token function-variable function">clickFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                              <span class="token keyword">return</span>
                          <span class="token punctuation">}</span>
                          dom<span class="token punctuation">.</span>outerHTML <span class="token operator">=</span> <span class="token string">''</span>
                          dom<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> clickFn<span class="token punctuation">)</span>
                          dom <span class="token operator">=</span> <span class="token keyword">null</span>
                      <span class="token punctuation">}</span>

                      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                          <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
                          <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token string">'dialog-error-id-'</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span>

                          div<span class="token punctuation">.</span>id <span class="token operator">=</span> id
                          div<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'dialog-error'</span>
                          div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;div class=&quot;dialog-error-box&quot;&gt;&lt;div class=&quot;dialog-error-box-close&quot;&gt;&lt;i class=&quot;el-icon-close dialog-error-box-close-btn&quot;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&quot;dialog-error-box-text1&quot;&gt;&lt;/div&gt;&lt;div class=&quot;dialog-error-box-text2&quot;&gt;&lt;/div&gt;&lt;div class=&quot;dialog-error-box-text3&quot;&gt;&lt;/div&gt;&lt;div class=&quot;dialog-error-box-text4&quot;&gt;&lt;/div&gt;&lt;/div&gt;'</span>
                          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
                          dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

                          dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dialog-error-box-close'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> clickFn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                      <span class="token punctuation">}</span>

                      dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dialog-error-box-text1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> text1
                      dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dialog-error-box-text2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> text2
                      dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dialog-error-box-text3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> text3
                      dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dialog-error-box-text4'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> text4

                      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                          <span class="token function">clickFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                  <span class="token function">errorFn</span><span class="token punctuation">(</span><span class="token string">'系统错误'</span><span class="token punctuation">,</span> <span class="token string">'请联系：李燕【liyan476】【18790129880】'</span><span class="token punctuation">,</span> <span class="token string">'梁子厚【liangzihou】【13926128469】'</span><span class="token punctuation">,</span> <span class="token string">'陈容容【chenrongrong14】【18061883502】'</span><span class="token punctuation">)</span>
        <span class="token comment">// Vue.errorMsg(&quot;系统错误，请联系管理员&quot;);</span>
        <span class="token comment">// this.$waringTips(&quot;系统错误，请联系管理员&quot;, &quot;.form-error-tips&quot;);</span>
              <span class="token punctuation">}</span>
              <span class="token function">sError</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          _this<span class="token punctuation">.</span><span class="token function">$loadingClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          _this<span class="token punctuation">.</span>disabled <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> _this<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token string">''</span>
          autoCloseLoading <span class="token operator">&amp;&amp;</span> _this<span class="token punctuation">.</span><span class="token function">$loadingClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">error403</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
          <span class="token function">sError</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
          _this<span class="token punctuation">.</span><span class="token function">$loadingClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          _this<span class="token punctuation">.</span><span class="token function">$loading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
          _this<span class="token punctuation">.</span>disabled <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> _this<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token string">''</span>
          autoCloseLoading <span class="token operator">&amp;&amp;</span> _this<span class="token punctuation">.</span><span class="token function">$loadingClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="promiseget"><a href="#promiseget" class="header-anchor">#</a> $promiseGet</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$promiseGet <span class="token operator">=</span> <span class="token function">requestTypeFactory</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$promiseGet</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/plat/categories/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/hasNewDrawFile</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	 
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token keyword">function</span> <span class="token function">requestTypeFactory</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> $data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">try</span> <span class="token punctuation">{</span>
						<span class="token keyword">return</span> <span class="token function">modelCheck</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">errorHandler</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> data<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[promiseRequest:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> $data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>$data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resData<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> resData<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">errorHandler</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>	


<span class="token comment">/**
 * @param {object} payload
 * @param {...Model} model - 对payload进行检测的数据模型描述
 * @param {boolean} [cloneData=true] - 默认:true;是否克隆payload数据
 * @param {boolean} [onlyModelDesciprtors=true] - 默认:true;指定为true，则只返回model中定义的key值
 * @param {boolean} [warnAsError=true] - 默认:true;是否将警告以错误抛出
 * @param {function} [errorReceiver=null] - (Error) =&gt; any // 注入外部方法来接收错误信息
 * @returns {object}
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">modelCheck</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> model<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  onlyModelDesciprtors <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  cloneData <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  warnAsError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  errorReceiver <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isArray</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Expected Object or Array'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Expected Object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    onlyModelDesciprtors<span class="token punctuation">,</span>
    cloneData<span class="token punctuation">,</span>
    warnAsError<span class="token punctuation">,</span>
    errorReceiver<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 对payload是数组的情况也进行支持</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">modelCheck</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token number">0</span><span class="token operator">:</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token operator">:</span> model <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 解除引用</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> cloneData <span class="token operator">?</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">:</span> payload<span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> defaultArg <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ifNoPropCreate</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// replace?: any,</span>
      <span class="token comment">// model?: object,</span>
      <span class="token comment">// validateBeforeReplace?: (value, key) =&gt; any</span>
      <span class="token comment">// validator?: (value, key) =&gt; any,</span>
      <span class="token comment">// errorMsg?: string|error,</span>
      <span class="token comment">// remove?: boolean, // only for array model</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      defaultArg<span class="token punctuation">.</span>required <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>required<span class="token punctuation">)</span> <span class="token operator">?</span> v<span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>v<span class="token punctuation">.</span>required<span class="token punctuation">;</span>
      defaultArg<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>type<span class="token punctuation">,</span> warnAsError<span class="token punctuation">,</span> errorReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
      defaultArg<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>default<span class="token punctuation">)</span> <span class="token operator">?</span> v<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>  v<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
      defaultArg<span class="token punctuation">.</span>ifNoPropCreate <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>v<span class="token punctuation">.</span>ifNoPropCreate<span class="token punctuation">;</span>
      <span class="token comment">// 如果有replace字段则将其加入到defaultArg</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span><span class="token string">'replace'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        defaultArg<span class="token punctuation">.</span>replace <span class="token operator">=</span> v<span class="token punctuation">.</span>replace<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span><span class="token string">'validateBeforeReplace'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        defaultArg<span class="token punctuation">.</span>validateBeforeReplace <span class="token operator">=</span> v<span class="token punctuation">.</span>validateBeforeReplace<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span><span class="token string">'validator'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        defaultArg<span class="token punctuation">.</span>validator <span class="token operator">=</span> v<span class="token punctuation">.</span>validator<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span><span class="token string">'errorMsg'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        defaultArg<span class="token punctuation">.</span>errorMsg <span class="token operator">=</span> v<span class="token punctuation">.</span>errorMsg<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 认为是默认值</span>
      <span class="token comment">// defaultArg.default = isFunction(v) ? v() :v;</span>
      <span class="token comment">// defaultArg.type = ['*'];</span>

      <span class="token comment">// 默认是类型</span>
      defaultArg<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> warnAsError<span class="token punctuation">,</span> errorReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> isExistKey <span class="token operator">=</span> <span class="token function">hasNamespace</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 排除原型链属性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>defaultArg<span class="token punctuation">.</span>ifNoPropCreate <span class="token operator">&amp;&amp;</span> defaultArg<span class="token punctuation">.</span>required <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isExistKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// throw new ReferenceError(`${k} is required`);</span>
      <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">property </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is required</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> warnAsError<span class="token punctuation">,</span> errorReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> valueToCheck <span class="token operator">=</span> defaultArg<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isExistKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> $ref <span class="token operator">=</span> <span class="token function">getNamespaceReference</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      valueToCheck <span class="token operator">=</span> $ref<span class="token punctuation">.</span>object<span class="token punctuation">[</span>$ref<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndefined</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      valueToCheck <span class="token operator">=</span> defaultArg<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 在replace前验证数据有效性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>validateBeforeReplace<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">validate</span><span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>validateBeforeReplace<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> valueToCheck<span class="token punctuation">,</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> k<span class="token punctuation">,</span>
        <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> defaultArg<span class="token punctuation">.</span>errorMsg<span class="token punctuation">,</span>
        errorReceiver<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span><span class="token string">'replace'</span><span class="token punctuation">,</span> defaultArg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      valueToCheck <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>replace<span class="token punctuation">)</span> <span class="token operator">?</span> defaultArg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token operator">:</span> defaultArg<span class="token punctuation">.</span>replace<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">typeCheck</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> valueToCheck<span class="token punctuation">,</span> defaultArg<span class="token punctuation">.</span>type<span class="token punctuation">,</span> warnAsError<span class="token punctuation">,</span> errorReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isExistKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setNamespaceValue</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">,</span> valueToCheck<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>ifNoPropCreate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setNamespaceValue</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">,</span> valueToCheck<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    isExistKey <span class="token operator">=</span> <span class="token function">hasNamespace</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>required <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isExistKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// throw new ReferenceError(`${k} is required`);</span>
      <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">property </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is required</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> warnAsError<span class="token punctuation">,</span> errorReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果存在model字段描述，可以是object和function</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> $model <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token operator">?</span> v<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token operator">:</span> v<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> itemsToRemove <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> valueToCheck<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> itemModel <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token operator">?</span> v<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">:</span> v<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
          <span class="token comment">// 如果有remove字段标识，则数组此项会被移除</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>itemModel<span class="token punctuation">.</span>remove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            itemsToRemove<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 对数组的每一项使用model描述进行验证</span>
            valueToCheck<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">modelCheck</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">:</span> valueToCheck<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">:</span> itemModel <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        valueToCheck <span class="token operator">=</span> valueToCheck<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>itemsToRemove<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        valueToCheck <span class="token operator">=</span> <span class="token function">modelCheck</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">,</span> $model<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setNamespaceValue</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> data<span class="token punctuation">,</span> valueToCheck<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 验证数据有效性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>validator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">validate</span><span class="token punctuation">(</span>defaultArg<span class="token punctuation">.</span>validator<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> valueToCheck<span class="token punctuation">,</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> k<span class="token punctuation">,</span>
        <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> defaultArg<span class="token punctuation">.</span>errorMsg<span class="token punctuation">,</span>
        errorReceiver<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 只使用model中定义的key</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onlyModelDesciprtors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNamespace</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> $ref <span class="token operator">=</span> <span class="token function">getNamespaceReference</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> $ref<span class="token punctuation">.</span>object<span class="token punctuation">[</span>$ref<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        tData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">createNestedObject</span><span class="token punctuation">(</span>tData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
  * 深度克隆，解除引用
  * 目标： 只对strictObject和数组解除引用
  * 注意：
  * 1.对于循环引用对象抛出错误
  * 2.原型的处理只会对自己本身的原型进行处理，不处理内部属性对象的原型
  * 3.数组的原型永远是Array.prototype，并且不论copyAll是否为true，数组总是会有length属性
  * 4.舍弃set和get方法。
  * 5.没有做尾递归优化，拷贝层级深的对象，可能会出现堆栈溢出情况
  * 对于vue等框架变量是响应式的，这里舍弃set和get方法，毕竟是只关心拷贝后的值，一般只做数据备份而已
  * @update 2019/06/11 逻辑大改
  * @param {*} param - 要克隆的目标
  * @param {Boolean} [copyAll=false] - 是否克隆所有自身属性，例如不可枚举属性，Symbol属性，注意：数组的length属性总是会有的
  * @param {Boolean} [copyProto=true] - 是否复制原型，否则会使用Object.create(null)创建一个没有原型的对象;
  * @param {object} [theNewProto=null] - 当copyProto=false时，如果提供了此值则会作为新的原型
  * @returns {*}
  */</span>
 <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">,</span> copyAll <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> copyProto <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> theNewProto <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 非array或isType === 'object' 返回本身</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">typeIsArrayOrObject</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> param<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">const</span> descriptors <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> descriptorsArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token comment">// copyAll=false只拷贝可遍历属性</span>
   <span class="token function">getAllKeys</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">const</span> descriptor <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>copyAll <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span>copyAll <span class="token operator">&amp;&amp;</span> descriptor<span class="token punctuation">.</span>enumerable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       descriptors<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> descriptor<span class="token punctuation">;</span>
       descriptorsArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>k<span class="token punctuation">,</span> descriptor<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   descriptorsArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">typeIsArrayOrObject</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// 对于循环引用对象抛出错误</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isArray</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasCircularStructure</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token constant">CIRCULAR_STRUCTURE_TIP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       descriptors<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>value<span class="token punctuation">,</span> copyAll<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// 舍弃get</span>
         <span class="token keyword">const</span> getResult <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 对于循环引用对象抛出错误</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>getResult<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isArray</span><span class="token punctuation">(</span>getResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasCircularStructure</span><span class="token punctuation">(</span>getResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token constant">CIRCULAR_STRUCTURE_TIP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         descriptors<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>getResult<span class="token punctuation">,</span> copyAll<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">'set'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// 舍弃set</span>
         Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">'set'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 设置可写属性</span>
         v<span class="token punctuation">.</span>configurable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         v<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 对于数组单独设置不可遍历的属性length</span>
     descriptors<span class="token punctuation">.</span>length <span class="token operator">=</span> descriptors<span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token punctuation">{</span>
       <span class="token literal-property property">value</span><span class="token operator">:</span> param<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
       <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> descriptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">const</span> prototype <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>copyProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token function">getPrototype</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theNewProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> theNewProto<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> descriptors<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/JavaScript-MDN/beforeNote/docs/theory/TCP.html" class="prev">
        /JavaScript-MDN/beforeNote/docs/theory/TCP.html
      </a></span> <span class="next"><a href="/JavaScript-MDN/beforeNote/docs/theory/后端接口.html">
        后端接口篇
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.78ed8d42.js" defer></script><script src="/assets/js/2.ed6f9a26.js" defer></script><script src="/assets/js/75.97c06d97.js" defer></script>
  </body>
</html>
